---
import Layout from "../layouts/Layout.astro";
import InfoSection from "../components/UI/Info-section/InfoSection.astro";
import fetchApi from "../lib/strapi";

interface PageHeader {
  id: number;
  title: string;
  subtitle?: string;
}

interface SustainabilitySection {
  id: number;
  sectionTitle: string;
  sectionDetails: string;
  sectionId?: string;
  accordion?: Accordion[];
}

interface Accordion {
  id: number;
  heading: string;
  details: string;
  displayOrder?: number;
}

interface SustainabilityPageData {
  pageHeader: PageHeader[];
  sustainabilitySections: SustainabilitySection[];
}

const sustainabilityPageData: SustainabilityPageData | null = await fetchApi({
  endpoint: "sustainability-page",
  query: {
    "populate[pageHeader]": "*",
    "populate[sustainabilitySections][populate][accordion]": "*",
  },
  wrappedByKey: "data",
});
---

<Layout title="Sustainability - Hopkins Creek Festival">
  <div class="container mx-auto px-4 py-8">
    {
      sustainabilityPageData?.pageHeader?.[0] && (
        <div class="text-center mb-8">
          <h1 class="text-4xl font-bold mb-4">
            {sustainabilityPageData.pageHeader[0].title}
          </h1>
          {sustainabilityPageData.pageHeader[0].subtitle && (
            <p class="text-xl text-base-content/70">
              {sustainabilityPageData.pageHeader[0].subtitle}
            </p>
          )}
        </div>
      )
    }

    {
      sustainabilityPageData?.sustainabilitySections &&
      sustainabilityPageData.sustainabilitySections.length > 0 ? (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {sustainabilityPageData.sustainabilitySections.map(
            (section, index) => {
              const accordionItems =
                section.accordion?.map((acc) => ({
                  title: acc.heading,
                  content: acc.details,
                })) || [];

              return (
                <div class="card bg-base-100 shadow-lg border border-base-300 hover:shadow-xl transition-shadow">
                  <div class="card-body">
                    <h2 class="card-title text-xl mb-4 text-primary">
                      {section.sectionTitle}
                    </h2>
                    {section.sectionDetails && (
                      <p class="text-base-content/70 mb-4">
                        {section.sectionDetails}
                      </p>
                    )}
                    <InfoSection
                      items={accordionItems}
                      groupName={`section-${section.id || index}`}
                      class="flex-1"
                    />
                  </div>
                </div>
              );
            }
          )}
        </div>
      ) : (
        <div class="text-center py-12">
          <p class="text-lg text-base-content/60">
            No sustainability information available at this time.
          </p>
        </div>
      )
    }
  </div>
</Layout>

<style>
  .card {
    transition: all 0.3s ease;
    height: 100%;
  }

  .card:hover {
    transform: translateY(-2px);
  }

  .card-body {
    display: flex;
    flex-direction: column;
  }
</style>
